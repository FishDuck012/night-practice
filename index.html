<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>夜練</title>
<style>

body {
  margin: 0;
  background: #0b1d25;
  font-family: sans-serif;
  display: flex;
  justify-content: center;
}

#app {
  width: 100%;
  max-width: 600px;
  text-align: center;
  padding: 20px;
  color: white;
}

textarea {
  width: 100%;
  height: 100px;
  margin-bottom: 15px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(5, 70px);
  gap: 12px;
}

.cell {
  width: 70px;
  height: 70px;
  background: #111;
  border: 2px solid white;
  border-radius: 12px;
}

.cell.active {
  background: orange;
}

#output {
  display: flex;
  flex-direction: column;
  gap: 60px;
  align-items: center;
  padding-bottom: 100px;
}

#app.immersive {
  position: fixed;
  inset: 0;
  background: #0b1d25;
  overflow-y: auto;
  z-index: 9999;
}

button {
  margin: 5px;
  padding: 8px 15px;
}

</style>
</head>
<body>

<div id="app">

  <h2>夜練</h2>

  <textarea id="input" placeholder="5 6 8&#10;15"></textarea>

  <div>
    <button onclick="generate()">生成</button>
    <button onclick="toggleImmersive()">沉浸</button>
    <button onclick="togglePlay()">播放</button>
  </div>

  <div id="output"></div>

</div>

<script>

let playing = false;
let animationId = null;

function generate() {
  const input = document.getElementById("input").value.trim();
  const output = document.getElementById("output");
  output.innerHTML = "";

  if (!input) return;

  const lines = input.split(/\r?\n/);

  lines.forEach(line => {
    if (!line.trim()) return;

    const numbers = line.trim().split(/\s+/);
    const grid = document.createElement("div");
    grid.className = "grid";

    for (let i = 1; i <= 15; i++) {
      const cell = document.createElement("div");
      cell.className = "cell";

      if (numbers.includes(i.toString())) {
        cell.classList.add("active");
      }

      grid.appendChild(cell);
    }

    output.appendChild(grid);
  });
}

function toggleImmersive() {
  document.getElementById("app").classList.toggle("immersive");
}

function togglePlay() {
  if (playing) {
    stopScroll();
  } else {
    startScroll();
  }
}

function startScroll() {
  if (!document.getElementById("app").classList.contains("immersive")) return;

  playing = true;

  function scrollLoop() {
    if (!playing) return;

    document.getElementById("app").scrollTop += 1;

    animationId = requestAnimationFrame(scrollLoop);
  }

  scrollLoop();
}

function stopScroll() {
  playing = false;
  cancelAnimationFrame(animationId);
}

document.getElementById("app").addEventListener("click", function(e) {
  if (playing) {
    stopScroll();
    return;
  }

  if (document.getElementById("app").classList.contains("immersive") &&
      (e.target.id === "app" || e.target.id === "output")) {
    document.getElementById("app").classList.remove("immersive");
  }
});

</script>

</body>
</html>
